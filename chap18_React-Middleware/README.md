# 리덕스 미들웨어를 통한 비동기 작업 관리
* 리덕스를 사용하고 있고, 비동기 작업을 관리해야할 경우
    - 미들웨어를 사용하여 매우 효율적이고 편하게 상태 관리를 할 수 있음

## 미들에어란?
* 액션을 디스패치했을 때 리듀서에서 이를 처리하기에 앞서 사전에 지정된 작업들을 실행
    - 액션과 리듀서 사이의 중간자
    - 액션 -> 미들웨어 -> 리듀서 -> 스토어
* 리듀서가 액션을 처리하기 전 미들웨어가 할 수 있는 작업     
    1.전달받은 액션을 단순히 콘솔에 기록     
    2.전달받은 액션 정보를 기반으로 액션을 아예 취소     
    3.다른 종류의 액션을 추가로 디스패치     
* 함수를 반환하는 함수를 반환하는 함수
    - lib/loggerMiddleware.js 참고

## 유효성 검사
* 데이터를 불러와서 렌더링해 줄때는 유효성 검사를 해 주는 것이 중요
    - 데이터가 없는 상태(undefined, null)를 조회할 경우 자바스크립트 오류가 발생

## redux-logger
```
yarn add redux-logger
```
* loggerMiddleware보다 훨씬 더 잘 만들어진 라이브러리
    - 브라우저 콘솔에 나타나는 형식도 훨씬 깔끔
        + 색상 추가
        + 액션 디스패치 시간 표시

## redux-thunk
```
yarn add redux-thunk
```
* 객체가 아닌 함수 형태의 액션을 디스패치하여 비동기 작업을 처리
* Thunk란?
    - 특정 작업을 나중에 할 수 있도록 미루기 위해 함수 형태로 감싼 것을 의미
* thunk 함수를 만들어 디스패치 하면 미들웨어가 그 함수를 전달받아 store의 dispatch와 getState를 파라미터로 넣어서 호출
```
const sampleThunk = () => (dispatch, getState) => {
    // 현재 상태 참조 가능
    // 새 액션을 디스패치 가능
}
```
* 한 요청당 3개의 액션타입 선언
    - thunk 함수 내부에서는 시작할 때, 성공했을 때, 실패했을 때 다른 액션을 디스패치
* lib/createRequestThunk.js로 리팩토링

## redux-saga
```
yarn add redux-saga
```
* 특정 액션이 디스패치되었을 때 정해진 로직에 따라 다른 액션을 디스패치시키는 규칙을 작성하여 비동기 작업을 처리
    - 디스패치하는 액션을 모니터링해서 그에 따라 필요한 작업을 따로 수행할 수 있는 미들웨어
* redux-saga를 사용하면 유리한 경우     
    1.기존 요청을 취소 처리해야 할 때(불필요한 중복 요청 방지)     
    2.특정 액션이 발생했을 때 다른 액션을 발생시키거나, API 요청 등 리덕스와 관계없는 코드를 실행할 때     
    3.웹소켓을 사용할 때     
    4.API 요청 실패시 재요청해야 할 때     

    ### 제네레이터 함수
    * 함수에서 값을 순차적으로 반환할 수 있음
    * 함수를 작성할 때 함수를 특정 구간에 멈춰 놓을 수도 있고, 원할 때 다시 돌아가게 할 수도 있음
    * 제네레이터 함수를 만들 때는 function* 키워드를 사용
        - next()가 호출되면 다음 yield가 있는 곳까지 호출하고 다시 함수가 멈춤
* 알아두면 유용한 기능
    - [메뉴얼] : https://redux-saga.js.org/     
    1.all : 여러 사가를 합쳐주는 역할     
    2.takeEvery : 디스패치되는 모든 액션에 특정 작업을 처리     
    3.takeLatest : 기존에 진행중이던 작업이 있다면 취소처리하고 가장 마직막으로 실행된 작업만 수행     
    4.call : Promise를 반환하는 함수를 호출하고, 기다릴 수 있음     
        - call(함수, 해당 함수에 넣을 인수)     
    5.put : 특정 액션을 디스패치     
    6.select : 현재 상태를 조회     
    7.throttle : 사가가 n초에 단 한번만 호출되도록 설정     
        - throttle(n초 * 1000, 액션, 함수);     
    8.액션에 마우스 클릭 이벤트가 payload 안에 들어가지 않게 하려면 두번째 파라미터로 () => undefined를 넣어 줌     
        - counter.js